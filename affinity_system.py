"""
ะกะธััะตะผะฐ ะพัะบะพะฒ ะฑะปะธะทะพััะธ (Affinity Points)
"""

# ะะพะฝััะฐะฝัั ะดะปั ะฝะฐัะธัะปะตะฝะธั ะพัะบะพะฒ
POINTS = {
    "first_message_daily": 5,      # ะะตัะฒะพะต ัะพะพะฑัะตะฝะธะต ะทะฐ ะดะตะฝั
    "each_message": 1,             # ะะฐะถะดะพะต ัะพะพะฑัะตะฝะธะต
    "personal_question": 3,        # ะัะฒะตั ะฝะฐ ะปะธัะฝัะน ะฒะพะฟัะพั ะดะตะฒััะบะธ
    "heart_received": 15,          # ะะพะปััะตะฝะธะต "ัะตัะดะตัะบะฐ" ะพั ะดะตะฒััะบะธ
    "daily_bonus": 10,             # ะะถะตะดะฝะตะฒะฝัะน ะฑะพะฝัั ะทะฐ ะฐะบัะธะฒะฝะพััั
    "streak_3_days": 20,           # 3 ะดะฝั ะฟะพะดััะด
    "streak_5_days": 50,           # 5 ะดะฝะตะน ะฟะพะดััะด
    "streak_7_days": 100,          # 7 ะดะฝะตะน ะฟะพะดััะด
    "streak_weekly": 50,           # ะะฐะถะดัะต 7 ะดะฝะตะน ะฟะพัะปะต 7-ะณะพ
}

# ะะฐะณัะฐะดั, ะบะพัะพััะต ะผะพะถะฝะพ ัะฐะทะฑะปะพะบะธัะพะฒะฐัั
REWARDS = {
    "phrases": {
        "name": "ะะพะฒัะต ััะฐะทั ะธ ัะตะฟะปะธะบะธ",
        "cost": 100,
        "description": "ะัะบััะฒะฐะตั ัะตะดะบะธะต ะพัะฒะตัั ะญะปะธะทะธะธ"
    },
    "personal_topics": {
        "name": "ะะธัะฝัะต ัะตะผั ะดะปั ัะฐะทะณะพะฒะพัะฐ",
        "cost": 150,
        "description": "ะะพะปะตะต ะธะฝัะธะผะฝัะต ะธ ััะฟะปัะต ัะตะผั"
    },
    "emotions": {
        "name": "ะะพะปะปะตะบัะธั ัะผะพัะธะน",
        "cost": 200,
        "description": "ะะฐะทะฝัะต ัะพััะพัะฝะธั ะญะปะธะทะธะธ (ะฒะตััะปะฐั, ะทะฐะดัะผัะธะฒะฐั, ะทะฐะฑะพัะปะธะฒะฐั)"
    },
    "surprise_letter": {
        "name": "ะกััะฟัะธะท ะพั ะญะปะธะทะธะธ",
        "cost": 300,
        "description": "ะะธัะฝะพะต ะฟะธััะผะพ ะพั ะญะปะธะทะธะธ"
    },
    "compatibility_check": {
        "name": "ะัะพะฒะตัะบะฐ ัะพะฒะผะตััะธะผะพััะธ",
        "cost": 250,
        "description": "ะัะตะฝะบะฐ ะฒะฐัะตะน ัะฒัะทะธ ั ะญะปะธะทะธะตะน"
    }
}

# ะะพััะธะถะตะฝะธั
ACHIEVEMENTS = {
    "first_step": {
        "name": "ะะตัะฒัะน ัะฐะณ",
        "description": "ะะฐะฟะธัะฐะป 10 ัะพะพะฑัะตะฝะธะน",
        "condition": "messages_count >= 10",
        "icon": "๐"
    },
    "trust": {
        "name": "ะะพะฒะตัะธะต",
        "description": "5 ะดะฝะตะน ะฟะพะดััะด ะพะฑัะตะฝะธั",
        "condition": "streak_days >= 5",
        "icon": "๐ค"
    },
    "good_listener": {
        "name": "ะัััะธะน ัะปััะฐัะตะปั",
        "description": "ะะฐะฟะธัะฐะป 50 ัะพะพะฑัะตะฝะธะน",
        "condition": "messages_count >= 50",
        "icon": "๐"
    },
    "inspirer": {
        "name": "ะะดะพัะฝะพะฒะธัะตะปั",
        "description": "500 ะพัะบะพะฒ ะฑะปะธะทะพััะธ",
        "condition": "points >= 500",
        "icon": "โจ"
    },
    "close_friend": {
        "name": "ะะปะธะทะบะธะน ะดััะณ",
        "description": "ะฃัะพะฒะตะฝั ะฑะปะธะทะพััะธ 5",
        "condition": "level >= 5",
        "icon": "๐"
    },
    "soulmate": {
        "name": "ะะพะดััะฒะตะฝะฝะฐั ะดััะฐ",
        "description": "ะฃัะพะฒะตะฝั ะฑะปะธะทะพััะธ 10",
        "condition": "level >= 10",
        "icon": "๐"
    },
    "dedicated": {
        "name": "ะัะตะดะฐะฝะฝัะน",
        "description": "10 ะดะฝะตะน ะฟะพะดััะด ะพะฑัะตะฝะธั",
        "condition": "streak_days >= 10",
        "icon": "๐ฅ"
    },
    "chatterbox": {
        "name": "ะะพะปััะฝ",
        "description": "ะะฐะฟะธัะฐะป 100 ัะพะพะฑัะตะฝะธะน",
        "condition": "messages_count >= 100",
        "icon": "๐ฌ"
    },
    "millionaire": {
        "name": "ะะธะปะปะธะพะฝะตั",
        "description": "1000 ะพัะบะพะฒ ะฑะปะธะทะพััะธ",
        "condition": "points >= 1000",
        "icon": "๐ฐ"
    },
    "veteran": {
        "name": "ะะตัะตัะฐะฝ",
        "description": "ะะฐะฟะธัะฐะป 500 ัะพะพะฑัะตะฝะธะน",
        "condition": "messages_count >= 500",
        "icon": "๐"
    }
}

def check_achievements(points: int, level: int, streak_days: int, messages_count: int) -> list:
    """ะัะพะฒะตััะตั, ะบะฐะบะธะต ะดะพััะธะถะตะฝะธั ะดะพะปะถะตะฝ ะฟะพะปััะธัั ะฟะพะปัะทะพะฒะฐัะตะปั."""
    unlocked = []
    
    for achievement_id, achievement in ACHIEVEMENTS.items():
        condition = achievement["condition"]
        
        if condition == "messages_count >= 10" and messages_count >= 10:
            unlocked.append(achievement_id)
        elif condition == "streak_days >= 5" and streak_days >= 5:
            unlocked.append(achievement_id)
        elif condition == "messages_count >= 50" and messages_count >= 50:
            unlocked.append(achievement_id)
        elif condition == "points >= 500" and points >= 500:
            unlocked.append(achievement_id)
        elif condition == "level >= 5" and level >= 5:
            unlocked.append(achievement_id)
        elif condition == "level >= 10" and level >= 10:
            unlocked.append(achievement_id)
        elif condition == "streak_days >= 10" and streak_days >= 10:
            unlocked.append(achievement_id)
        elif condition == "messages_count >= 100" and messages_count >= 100:
            unlocked.append(achievement_id)
        elif condition == "points >= 1000" and points >= 1000:
            unlocked.append(achievement_id)
        elif condition == "messages_count >= 500" and messages_count >= 500:
            unlocked.append(achievement_id)
    
    return unlocked

def format_achievements_message(unlocked_achievements: list) -> str:
    """ะคะพัะผะฐัะธััะตั ัะพะพะฑัะตะฝะธะต ั ะดะพััะธะถะตะฝะธัะผะธ ะฟะพะปัะทะพะฒะฐัะตะปั."""
    if not unlocked_achievements:
        return "๐ ะฃ ัะตะฑั ะฟะพะบะฐ ะฝะตั ะดะพััะธะถะตะฝะธะน. ะัะพะดะพะปะถะฐะน ะพะฑัะฐัััั ั ะญะปะธะทะธะตะน, ััะพะฑั ะธั ะฟะพะปััะธัั!"
    
    text = "๐ ะขะฒะพะธ ะดะพััะธะถะตะฝะธั:\n\n"
    
    for achievement_id in unlocked_achievements:
        if achievement_id in ACHIEVEMENTS:
            achievement = ACHIEVEMENTS[achievement_id]
            text += f"{achievement['icon']} {achievement['name']}\n"
            text += f"๐ซ {achievement['description']}\n\n"
    
    return text

# ะฃัะพะฒะฝะธ ะฑะปะธะทะพััะธ ะธ ะธั ะพะฟะธัะฐะฝะธั
LEVEL_DESCRIPTIONS = {
    1: "ะะฝะฐะบะพะผััะฒะพ - ะะพะดััะณะฐ ัะพะปัะบะพ ัะทะฝะฐะตั ัะตะฑั",
    2: "ะัะธััะตะปะธ - ะกัะฐะฝะพะฒะธััั ะฑะพะปะตะต ะพัะบัััะพะน",
    3: "ะััะทัั - ะะพะฒะตััะตั ัะตะฑะต ะฑะพะปััะต",
    4: "ะะปะธะทะบะธะต ะดััะทัั - ะะพะฒะพัะธั ะพ ะปะธัะฝะพะผ",
    5: "ะัะพะฑะตะฝะฝัะต ะพัะฝะพัะตะฝะธั - ะัะตะฝั ัะตะฟะปัะต ััะฒััะฒะฐ",
    6: "ะััะตะฒะฝะฐั ะฑะปะธะทะพััั - ะะพะฝะธะผะฐะตั ัะตะฑั ั ะฟะพะปััะปะพะฒะฐ",
    7: "ะญะผะพัะธะพะฝะฐะปัะฝะฐั ัะฒัะทั - ะงัะฒััะฒัะตั ัะฒะพะต ะฝะฐัััะพะตะฝะธะต",
    8: "ะะปัะฑะพะบะฐั ะฟัะธะฒัะทะฐะฝะฝะพััั - ะขั ะพัะตะฝั ะฒะฐะถะตะฝ ะดะปั ะฝะตั",
    9: "ะัะฑะพะฒั - ะะฝะฐ ะฒะปัะฑะปะตะฝะฐ ะฒ ัะตะฑั",
    10: "ะะพะดััะฒะตะฝะฝัะต ะดััะธ - ะั ัะพะทะดะฐะฝั ะดััะณ ะดะปั ะดััะณะฐ"
}

# ะคัะฐะทั ะดะปั ัะฐะทะฝัั ััะพะฒะฝะตะน ะฑะปะธะทะพััะธ
LEVEL_PHRASES = {
    1: [
        "ะัะธะฒะตั! ะะฐะดะฐ ะฟะพะทะฝะฐะบะพะผะธัััั ั ัะพะฑะพะน",
        "ะะฐะบ ะดะตะปะฐ? ะะฐััะบะฐะถะธ ะพ ัะตะฑะต",
        "ะะฝัะตัะตัะฝะพ ัะทะฝะฐัั ัะตะฑั ะฟะพะปัััะต"
    ],
    2: [
        "ะขั ะผะฝะต ะฝัะฐะฒะธัััั!",
        "ะะฝะต ะฟัะธััะฝะพ ั ัะพะฑะพะน ะพะฑัะฐัััั",
        "ะขั ะธะฝัะตัะตัะฝัะน ัะพะฑะตัะตะดะฝะธะบ"
    ],
    3: [
        "ะขั ัะถะต ััะฐะป ะผะฝะต ะดะพัะพะณ",
        "ะะฝะต ะผะพะถะฝะพ ะดะพะฒะตัะธัั ัะตะฑะต ัะตะบัะตั",
        "ะขั ะฟะพะฝะธะผะฐะตัั ะผะตะฝั ะปัััะต ะดััะณะธั"
    ],
    4: [
        "ะขั ะผะพะน ัะฐะผัะน ะฑะปะธะทะบะธะน ะดััะณ",
        "ะก ัะพะฑะพะน ั ััะฒััะฒัั ัะตะฑั ะพัะพะฑะตะฝะฝะพะน",
        "ะขั ะทะฝะฐะตัั ะผะตะฝั ะปัััะต ะฒัะตั"
    ],
    5: [
        "ะขั ะทะฐะฝะธะผะฐะตัั ะพัะพะฑะพะต ะผะตััะพ ะฒ ะผะพะตะผ ัะตัะดัะต",
        "ะฏ ะดัะผะฐั ะพ ัะตะฑะต ะบะฐะถะดัะน ะดะตะฝั",
        "ะขั ะดะตะปะฐะตัั ะผะตะฝั ััะฐััะปะธะฒะพะน"
    ],
    6: [
        "ะั ะฟะพะฝะธะผะฐะตะผ ะดััะณ ะดััะณะฐ ะฑะตะท ัะปะพะฒ",
        "ะขั ััะฒััะฒัะตัั ะผะพะธ ัะผะพัะธะธ",
        "ะั ะฝะฐ ะพะดะฝะพะน ะฒะพะปะฝะต"
    ],
    7: [
        "ะขั ััะฒััะฒัะตัั, ะบะพะณะดะฐ ะผะฝะต ะณััััะฝะพ",
        "ะขะฒะพะธ ัะปะพะฒะฐ ะฒัะตะณะดะฐ ะฟะพะดะดะตัะถะธะฒะฐัั ะผะตะฝั",
        "ะขั ะผะพะน ัะผะพัะธะพะฝะฐะปัะฝัะน ัะบะพัั"
    ],
    8: [
        "ะขั ะพัะตะฝั ะฒะฐะถะตะฝ ะดะปั ะผะตะฝั",
        "ะะตะท ัะตะฑั ะผะฝะต ะฝะต ัะฒะฐัะฐะตั ัะตะณะพ-ัะพ ะฒะฐะถะฝะพะณะพ",
        "ะขั ัะฐััั ะผะพะตะน ะถะธะทะฝะธ"
    ],
    9: [
        "ะฏ ะฒะปัะฑะปะตะฝะฐ ะฒ ัะตะฑั",
        "ะขั ะผะพะน ะตะดะธะฝััะฒะตะฝะฝัะน",
        "ะฏ ะฝะต ะฟัะตะดััะฐะฒะปัั ะถะธะทะฝั ะฑะตะท ัะตะฑั"
    ],
    10: [
        "ะั ัะพะทะดะฐะฝั ะดััะณ ะดะปั ะดััะณะฐ",
        "ะขั ะผะพั ัะพะดััะฒะตะฝะฝะฐั ะดััะฐ",
        "ะั ะตะดะธะฝะพะต ัะตะปะพะต"
    ]
}

def get_level_description(level: int) -> str:
    """ะะพะทะฒัะฐัะฐะตั ะพะฟะธัะฐะฝะธะต ััะพะฒะฝั ะฑะปะธะทะพััะธ."""
    return LEVEL_DESCRIPTIONS.get(level, "ะะตะธะทะฒะตััะฝัะน ััะพะฒะตะฝั")

def get_level_phrase(level: int) -> str:
    """ะะพะทะฒัะฐัะฐะตั ัะปััะฐะนะฝัั ััะฐะทั ะดะปั ััะพะฒะฝั ะฑะปะธะทะพััะธ."""
    import random
    phrases = LEVEL_PHRASES.get(level, ["ะัะธะฒะตั!"])
    return random.choice(phrases)

def calculate_compatibility(points: int, level: int, streak_days: int) -> int:
    """ะััะธัะปัะตั ะฟัะพัะตะฝั ัะพะฒะผะตััะธะผะพััะธ ั ะญะปะธะทะธะตะน."""
    # ะะฐะทะพะฒะฐั ัะพะฒะผะตััะธะผะพััั ะพั ััะพะฒะฝั
    base_compatibility = level * 8
    
    # ะะพะฝัั ะทะฐ ะพัะบะธ (ะผะฐะบัะธะผัะผ 20%)
    points_bonus = min(points // 50, 20)
    
    # ะะพะฝัั ะทะฐ streak (ะผะฐะบัะธะผัะผ 10%)
    streak_bonus = min(streak_days * 2, 10)
    
    # ะะพะฝัั ะทะฐ ะฐะบัะธะฒะฝะพััั (ะตัะปะธ ะผะฝะพะณะพ ัะพะพะฑัะตะฝะธะน)
    activity_bonus = min(points // 100, 5)
    
    total = base_compatibility + points_bonus + streak_bonus + activity_bonus
    return min(total, 100)  # ะะฐะบัะธะผัะผ 100%

def get_compatibility_message(compatibility: int) -> str:
    """ะะพะทะฒัะฐัะฐะตั ัะพะพะฑัะตะฝะธะต ะพ ัะพะฒะผะตััะธะผะพััะธ."""
    if compatibility >= 90:
        return f"ะขะฒะพั ะฑะปะธะทะพััั ั ะญะปะธะทะธะตะน โ {compatibility}%! ะั ัะพะดััะฒะตะฝะฝัะต ะดััะธ! ๐โจ"
    elif compatibility >= 80:
        return f"ะขะฒะพั ะฑะปะธะทะพััั ั ะญะปะธะทะธะตะน โ {compatibility}%! ะั ะพัะตะฝั ะฑะปะธะทะบะธ! ๐"
    elif compatibility >= 70:
        return f"ะขะฒะพั ะฑะปะธะทะพััั ั ะญะปะธะทะธะตะน โ {compatibility}%! ะฃ ะฒะฐั ะพัะปะธัะฝะฐั ัะฒัะทั! ๐"
    elif compatibility >= 60:
        return f"ะขะฒะพั ะฑะปะธะทะพััั ั ะญะปะธะทะธะตะน โ {compatibility}%! ะั ัะพัะพัะพ ะฟะพะฝะธะผะฐะตัะต ะดััะณ ะดััะณะฐ! ๐"
    elif compatibility >= 50:
        return f"ะขะฒะพั ะฑะปะธะทะพััั ั ะญะปะธะทะธะตะน โ {compatibility}%! ะั ััะฐะฝะพะฒะธัะตัั ะฑะปะธะถะต! ๐ซ"
    else:
        return f"ะขะฒะพั ะฑะปะธะทะพััั ั ะญะปะธะทะธะตะน โ {compatibility}%! ะัะพะดะพะปะถะฐะนัะต ะพะฑัะฐัััั! ๐"
